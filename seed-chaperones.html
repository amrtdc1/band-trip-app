<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Seed Chaperones</title>
  <style>
    body {
      font-family: system-ui, -apple-system, sans-serif;
      max-width: 600px;
      margin: 50px auto;
      padding: 20px;
    }
    button {
      padding: 12px 24px;
      background: #2563eb;
      color: white;
      border: none;
      border-radius: 8px;
      font-size: 16px;
      cursor: pointer;
    }
    button:hover {
      background: #1d4ed8;
    }
    #status {
      margin-top: 20px;
      padding: 15px;
      border-radius: 8px;
      display: none;
    }
    .success {
      background: #d1fae5;
      color: #065f46;
    }
    .error {
      background: #fee2e2;
      color: #991b1b;
    }
  </style>
</head>
<body>
  <h1>üéØ Seed Initial Chaperones</h1>
  <p>This will add the default chaperone list to Firestore.</p>
  <p><strong>Note:</strong> You must be signed in as an admin. Sign in to the admin page first, then come back here.</p>
  
  <button id="seedBtn">Seed Chaperones</button>
  <div id="status"></div>

  <script type="module">
    import { app, auth } from './firebase-init.js';
    import { getFirestore, collection, doc, setDoc, getDocs } from "https://www.gstatic.com/firebasejs/11.0.0/firebase-firestore.js";
    import { onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.0.0/firebase-auth.js";

    const db = getFirestore(app);
    
    const defaultChaperones = [
      "Mrs. Coffey",
      "Mr. Smith",
      "Mrs. Johnson",
      "Ms. Davis",
      "Mr. Williams",
      "Mrs. Brown",
      "Mr. Martinez"
    ];
    
    let isSignedIn = false;
    
    onAuthStateChanged(auth, (user) => {
      isSignedIn = !!user;
      const btn = document.getElementById('seedBtn');
      if (!user) {
        btn.textContent = 'üîí Sign in as admin first';
        btn.disabled = true;
        btn.style.opacity = '0.5';
        btn.style.cursor = 'not-allowed';
      } else {
        btn.textContent = 'Seed Chaperones';
        btn.disabled = false;
        btn.style.opacity = '1';
        btn.style.cursor = 'pointer';
      }
    });

    document.getElementById('seedBtn').addEventListener('click', async () => {
      if (!isSignedIn) {
        alert('Please sign in to the admin page first, then reload this page.');
        return;
      }
      
      const statusDiv = document.getElementById('status');
      statusDiv.style.display = 'block';
      statusDiv.className = '';
      statusDiv.textContent = 'Seeding chaperones...';

      try {
        // Check if chaperones already exist
        const existing = await getDocs(collection(db, 'chaperones'));
        if (existing.size > 0) {
          if (!confirm(`${existing.size} chaperone(s) already exist. Add these defaults anyway?`)) {
            statusDiv.style.display = 'none';
            return;
          }
        }

        let added = 0;
        const errors = [];
        
        for (const name of defaultChaperones) {
          try {
            await setDoc(doc(collection(db, 'chaperones')), { name });
            added++;
          } catch (err) {
            errors.push(`${name}: ${err.message}`);
          }
        }

        if (errors.length > 0) {
          statusDiv.className = 'error';
          statusDiv.textContent = `‚ö†Ô∏è Added ${added} chaperones. Errors:\n${errors.join('\n')}`;
        } else {
          statusDiv.className = 'success';
          statusDiv.textContent = `‚úÖ Successfully added ${added} chaperones! You can now manage them from the admin page.`;
        }
      } catch (err) {
        statusDiv.className = 'error';
        statusDiv.textContent = `‚ùå Error: ${err.message}\n\nMake sure you're signed in as an admin with proper permissions.`;
        console.error('Full error:', err);
      }
    });
  </script>
</body>
</html>
