<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Seed Chaperones</title>
  <style>
    body {
      font-family: system-ui, -apple-system, sans-serif;
      max-width: 600px;
      margin: 50px auto;
      padding: 20px;
    }
    button {
      padding: 12px 24px;
      background: #2563eb;
      color: white;
      border: none;
      border-radius: 8px;
      font-size: 16px;
      cursor: pointer;
    }
    button:hover {
      background: #1d4ed8;
    }
    #status {
      margin-top: 20px;
      padding: 15px;
      border-radius: 8px;
      display: none;
    }
    .success {
      background: #d1fae5;
      color: #065f46;
    }
    .error {
      background: #fee2e2;
      color: #991b1b;
    }
  </style>
</head>
<body>
  <h1>ðŸŽ¯ Seed Initial Chaperones</h1>
  <p>This will add the default chaperone list to Firestore. Run this once, then you can manage chaperones from the admin page.</p>
  
  <button id="seedBtn">Seed Chaperones</button>
  <div id="status"></div>

  <script type="module">
    import { app, auth, signInAdminWithGoogle, onAuth } from './firebase-init.js';
    import { getFirestore, collection, doc, setDoc, getDocs } from "https://www.gstatic.com/firebasejs/11.0.0/firebase-firestore.js";

    const db = getFirestore(app);
    
    const defaultChaperones = [
      "Mrs. Coffey",
      "Mr. Smith",
      "Mrs. Johnson",
      "Ms. Davis",
      "Mr. Williams",
      "Mrs. Brown",
      "Mr. Martinez"
    ];

    document.getElementById('seedBtn').addEventListener('click', async () => {
      const statusDiv = document.getElementById('status');
      statusDiv.style.display = 'block';
      statusDiv.className = '';
      statusDiv.textContent = 'Seeding chaperones...';

      try {
        // Check if chaperones already exist
        const existing = await getDocs(collection(db, 'chaperones'));
        if (existing.size > 0) {
          if (!confirm(`${existing.size} chaperone(s) already exist. Add these defaults anyway?`)) {
            statusDiv.style.display = 'none';
            return;
          }
        }

        let added = 0;
        for (const name of defaultChaperones) {
          await setDoc(doc(collection(db, 'chaperones')), { name });
          added++;
        }

        statusDiv.className = 'success';
        statusDiv.textContent = `âœ… Successfully added ${added} chaperones! You can now manage them from the admin page.`;
      } catch (err) {
        statusDiv.className = 'error';
        statusDiv.textContent = `âŒ Error: ${err.message}`;
        console.error(err);
      }
    });

    // Check auth status
    onAuth((user) => {
      if (!user) {
        document.getElementById('seedBtn').textContent = 'Sign in first';
        document.getElementById('seedBtn').addEventListener('click', () => {
          alert('Please sign in as admin in the main app first, then reload this page.');
        });
      }
    });
  </script>
</body>
</html>
